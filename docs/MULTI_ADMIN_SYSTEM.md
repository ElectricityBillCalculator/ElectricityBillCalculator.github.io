# ระบบการจัดการผู้ดูแลระบบหลายคน

## ภาพรวม

ระบบได้รับการปรับปรุงให้รองรับการสร้างผู้ดูแลระบบหลายคน โดยแต่ละคนจะดูแลได้แค่ 1 ตึกเท่านั้น ระบบนี้ช่วยให้สามารถจัดการหลายตึกได้อย่างเป็นอิสระ

## คุณสมบัติหลัก

### 1. **การสร้างผู้ดูแลระบบใหม่**
- ผู้ดูแลระบบแต่ละคนจะดูแลได้แค่ 1 ตึก
- รหัสตึกต้องไม่ซ้ำกับตึกอื่นในระบบ
- อีเมลต้องไม่ซ้ำกับผู้ใช้อื่นในระบบ
- หลังจากสร้างสำเร็จ ผู้ดูแลระบบสามารถเข้าสู่ระบบได้ทันที

### 2. **การแยกข้อมูลตามตึก**
- ข้อมูลห้องพักจะถูกกรองตามรหัสตึก
- ข้อมูลบิลจะถูกกรองตามรหัสตึก
- ผู้ดูแลระบบจะเห็นเฉพาะข้อมูลของตึกที่ตนดูแล

### 3. **การตั้งชื่อห้องพัก**
- ห้องพักในแต่ละตึกควรใช้รหัสที่ขึ้นต้นด้วยรหัสตึก
- ตัวอย่าง: ตึก A → ห้อง A101, A102, A103
- ตัวอย่าง: ตึก B → ห้อง B101, B102, B103

## วิธีการใช้งาน

### การสร้างผู้ดูแลระบบใหม่

1. **เข้าถึงหน้าสร้างผู้ดูแลระบบ**
   - ไปที่ `create-admin.html`
   - หรือคลิกลิงก์ "สร้างผู้ดูแลระบบ" ในหน้า login

2. **กรอกข้อมูลตึก**
   - **ชื่อตึก**: ชื่อที่เข้าใจง่าย เช่น "ตึก A", "อาคารพักอาศัย 1"
   - **รหัสตึก**: รหัสสั้นๆ ที่ไม่ซ้ำ เช่น "A", "BLDG1", "TOWER1"

3. **กรอกข้อมูลผู้ดูแลระบบ**
   - **ชื่อผู้ดูแลระบบ**: ชื่อ-นามสกุล
   - **อีเมล**: อีเมลสำหรับเข้าสู่ระบบ
   - **รหัสผ่าน**: อย่างน้อย 6 ตัวอักษร
   - **เบอร์โทรศัพท์**: (ไม่บังคับ)

4. **กรอกรายละเอียดตึก** (ไม่บังคับ)
   - **ที่อยู่**: ที่อยู่ของตึก
   - **จำนวนห้องทั้งหมด**: จำนวนห้องในตึก

5. **คลิก "สร้างผู้ดูแลระบบ"**
   - ระบบจะตรวจสอบความถูกต้องของข้อมูล
   - สร้างบัญชีผู้ใช้ใน Firebase Authentication
   - บันทึกข้อมูลตึกและผู้ดูแลระบบในฐานข้อมูล

### การเข้าสู่ระบบ

1. ผู้ดูแลระบบใหม่สามารถเข้าสู่ระบบได้ทันที
2. ระบบจะแสดงเฉพาะข้อมูลของตึกที่ตนดูแล
3. สามารถเพิ่มห้องพักและจัดการข้อมูลได้ตามปกติ

## โครงสร้างข้อมูล

### ข้อมูลตึก (buildings)
```json
{
  "A": {
    "buildingCode": "A",
    "buildingName": "ตึก A",
    "address": "123 ถนนสุขุมวิท",
    "totalRooms": 20,
    "createdAt": "2024-12-25T10:00:00.000Z",
    "createdBy": "user_uid",
    "adminUid": "admin_uid"
  }
}
```

### ข้อมูลผู้ใช้ (users)
```json
{
  "admin_uid": {
    "name": "สมชาย ใจดี",
    "email": "admin@example.com",
    "role": "admin",
    "buildingCode": "A",
    "buildingName": "ตึก A",
    "phone": "081-234-5678",
    "createdAt": "2024-12-25T10:00:00.000Z",
    "isAdmin": true,
    "managedRooms": []
  }
}
```

### ข้อมูลห้องพัก (rooms)
```json
{
  "A101": {
    "rent": 5000,
    "roomSize": "30 ตร.ม.",
    "tenantName": "สมหญิง รักดี",
    "buildingCode": "A",
    "createdAt": "2024-12-25T10:00:00.000Z",
    "createdBy": "admin_uid"
  }
}
```

### ข้อมูลบิล (electricityData)
```json
{
  "bill_key": {
    "room": "A101",
    "name": "สมหญิง รักดี",
    "date": "25/12/2024",
    "current": 12345,
    "previous": 12000,
    "units": 345,
    "rate": 4.5,
    "total": 1552.5,
    "buildingCode": "A",
    "createdAt": "2024-12-25T10:00:00.000Z",
    "createdBy": "admin_uid"
  }
}
```

## การตรวจสอบสิทธิ์

### สำหรับ Admin
- สามารถเห็นและจัดการเฉพาะข้อมูลของตึกที่ตนดูแล
- ห้องพักที่ขึ้นต้นด้วยรหัสตึกของตน
- บิลที่เกี่ยวข้องกับห้องพักในตึกของตน

### สำหรับ Level 1 Owner
- สามารถเห็นและจัดการห้องพักที่ตนได้รับมอบหมาย
- ข้อมูลจะถูกกรองตาม `managedRooms`

### สำหรับ Level 1 Tenant
- สามารถเห็นห้องพักที่ตนสามารถเข้าถึงได้
- ข้อมูลจะถูกกรองตาม `accessibleRooms`

## ข้อควรระวัง

1. **รหัสตึกต้องไม่ซ้ำ**: ระบบจะตรวจสอบและไม่อนุญาตให้สร้างรหัสตึกที่ซ้ำ
2. **อีเมลต้องไม่ซ้ำ**: ระบบจะตรวจสอบและไม่อนุญาตให้ใช้อีเมลที่ซ้ำ
3. **การตั้งชื่อห้อง**: ควรใช้รหัสที่ขึ้นต้นด้วยรหัสตึกเพื่อให้ระบบกรองข้อมูลได้ถูกต้อง
4. **การย้ายข้อมูล**: หากต้องการย้ายข้อมูลระหว่างตึก ต้องอัปเดต `buildingCode` ในฐานข้อมูล

## การแก้ไขปัญหา

### ปัญหาที่พบบ่อย

1. **Admin ไม่เห็นข้อมูล**
   - ตรวจสอบว่า admin มี `buildingCode` ในข้อมูลผู้ใช้
   - ตรวจสอบว่าข้อมูลห้องพักและบิลมี `buildingCode` ที่ตรงกัน

2. **ไม่สามารถสร้าง admin ใหม่**
   - ตรวจสอบว่ารหัสตึกไม่ซ้ำ
   - ตรวจสอบว่าอีเมลไม่ซ้ำ
   - ตรวจสอบการเชื่อมต่อ Firebase

3. **ข้อมูลแสดงผิดตึก**
   - ตรวจสอบ `buildingCode` ในข้อมูลห้องพักและบิล
   - ตรวจสอบการตั้งชื่อห้องพักว่าขึ้นต้นด้วยรหัสตึก

### การตรวจสอบข้อมูล

```javascript
// ตรวจสอบข้อมูล admin
const adminData = await db.ref(`users/${adminUid}`).once('value');
console.log('Admin data:', adminData.val());

// ตรวจสอบข้อมูลตึก
const buildingData = await db.ref(`buildings/${buildingCode}`).once('value');
console.log('Building data:', buildingData.val());

// ตรวจสอบห้องพักในตึก
const roomsSnapshot = await db.ref('rooms').orderByChild('buildingCode').equalTo(buildingCode).once('value');
console.log('Rooms in building:', roomsSnapshot.val());
```

## การพัฒนาต่อ

### ฟีเจอร์ที่อาจเพิ่มในอนาคต

1. **การจัดการหลายตึก**: ให้ admin หนึ่งคนดูแลได้หลายตึก
2. **การย้ายข้อมูลระหว่างตึก**: เครื่องมือสำหรับย้ายข้อมูลห้องพักระหว่างตึก
3. **รายงานรวม**: รายงานที่รวมข้อมูลจากหลายตึก
4. **การตั้งค่าตึก**: การตั้งค่าส่วนกลางสำหรับแต่ละตึก
5. **การแจ้งเตือนข้ามตึก**: การแจ้งเตือนสำหรับ admin หลายคน 